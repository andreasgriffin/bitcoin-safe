name: Build Windows Test Signing

env:
  signing-policy-slug: "test-signing"  
  commitHash: "" 

on:
  push:
    tags:
      - 'test-*'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Create empty .exe file
        run: |
          mkdir -p dist  # Create a directory to hold the file if it doesn't already exist
          touch dist/dummy.exe  # Create an empty .exe file

      - name: Upload EXE Files from dist/
        id: upload-unsigned-artifact
        uses: actions/upload-artifact@v4
        with:
          name: dist
          path: dist/*  # zip everything in the folder

      - name: 'signing with ${{ github.event.inputs.signing-policy-slug }}'
        id: signpath-io
        if: ${{ github.event.inputs.signing-policy-slug != '' }}
        uses: signpath/github-action-submit-signing-request@v1.1
        with:
          api-token: '${{ secrets.SIGNPATH_API_TOKEN }}'
          organization-id: '0981059c-bbd4-461c-abcf-b99bd074a723'
          project-slug: 'bitcoin-safe'
          signing-policy-slug: '${{ github.event.inputs.signing-policy-slug }}'
          github-artifact-id: '${{ steps.upload-unsigned-artifact.outputs.artifact-id }}'
          artifact-configuration-slug: 'Win'
          wait-for-completion: true
          output-artifact-directory: 'signpath-signed'


      - name: Upload Signed EXE Files from signpath-signed/
        if: ${{ github.event.inputs.signing-policy-slug != '' }}
        id: upload-signed-artifact
        uses: actions/upload-artifact@v4
        with:
          name: signpath-signed
          path: signpath-signed/*  # zip everything in the folder

